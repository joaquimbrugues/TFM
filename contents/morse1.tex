\section{Morse functions} \label{section:morse_functions}

Let us consider a differentiable manifold $M$ without boundary, and let $f : M \rightarrow \R$ be a smooth function.

\begin{deff}
	A point $p \in M$ is called a {\bf critical point} of the function $f$ if the tangent map $df_p : \straightT_pM \longrightarrow \straightT\R \cong \R$ is zero. In this case, we say that $f(p)$ is a {\bf critical value}.
\end{deff}

To classify the critical points of a function, we will be interested in the directions in which it is convex and the ones in which it is concave. The best way to study the convexity of a function systematically is its Hessian, or second derivative. However, we find ourselves with a constraint: it is not possible to define the Hessian of a function on a smooth manifold in all points in a way that it is independent of the choice of the coordinate system. However, it is possible to do it at each critical point, as we will show.

\begin{deff}
	Let $p$ be a critical point of a function $f \in \mathcal{C}^{\infty}(M)$. The {\bf Hessian} of $f$ at $p$ is the bilinear map
\[\begin{array}{rccc} \straightH_p[f] : & \straightT_pM \times \straightT_pM & \longrightarrow & \R \\ & (u,v) & \longmapsto & v(X_u(f)) \end{array} ,\]
where $X_u$ is a vector field extending $u \in \straightT_pM$ locally.
\end{deff}

To define the extension of a vector to a vector field, we use this lemma

\begin{lema}
	Let $u \in \straightT_pM$. There is a vector field $X_u \in \mathfrak{X}(M)$ such that $X_u(p) = u$.
\end{lema}

This lemma can be proved in a straightforward way using a suitable bump function defined inside a local chart of $p$ in $M$.

\begin{lema}
	The Hessian $\straightH_p[f]$ is well defined (this means, it does not depend on the choice of $X_u$), and it is a bilinear and symmetric map.
\end{lema}

\begin{proof}
	First, we show that it is symmetric, from where it will be clear that it is well defined:
\[\straightH_p[f](v,w) - \straightH_p[f](w,v) = v(X_w(f)) - w(X_v(f)) = \left. X_v \right|_p(X_w(f)) - \left. X_w \right|_p (X_v(f)) = \]
\[= \left. [X_v,X_w] \right|_p(f) = d_p f \cdot [X_v,X_w] = 0 ,\]
where the last term is zero because $d_p f = 0$, as $p$ is a critical point for $f$. Thus, if we choose extensions $X_v$ and $X_w$ for $v$ and $w$ (respectivelly), then $\straightH_p[f](v,w) = \straightH_p[f](w,v)$.

Looking again at the definition,
\[\straightH_p[f](v,w) = v(X_w(f)),\]
it is obvious that this does not depend on the extension $X_v$ that we choose for $v$, as in the expression only depends on $X_v(p) = v$ regardless of the extension. On the other hand, as we just proved, $\straightH_p[f](v,w) = \straightH_p[f](w,v)$, so, applying the same argument, the Hessian does not depend on the extension chosen for $w$. This proves that the Hessian is well defined.

Finally, the Hessian is bilinear, because
\[H_p[f](\alpha u + \beta v, w) = (\alpha u + \beta v)(X_w(f)) = \]
\[= \alpha u(X_w(f)) + \beta v(X_w(f)) = \alpha H_p[f](u,w) + \beta H_p[f](v,w) ,\]
and the same argument applies to the second component by symmetry.
\end{proof}

Notice that the last proof depends entirely on the fact that $p$ is a critical point. This means, in general it is not possible to prove that $\straightH_p[f]$ is well defined when $p$ is not a critical point.

\begin{rmrk}
	The local form of the Hessian of a function coincides with the Hessian of the local representation of the function in a chart. If $(x_1,...,x_n)$ is a local chart centered in a critical point $p \in M$ and $\tilde{f}$ is the local representation of $f$ in this chart, then the local expression of $\straightH_p[f]$ is precisely the matrix
\[\widetilde{\straightH}_p[f] := \left( \frac{\partial^2 \tilde{f}}{\partial x_i \partial x_j}(0) \right)_{i,j} .\]
\end{rmrk}

As we said before, we are interested in the Hessian of a function at a critical point to, in some way, count the number of directions in which the function is convex. To do so, we need the concepts of index and non-degeneracy.

\begin{deff}
	We define the

\begin{itemize}
	\item {\bf Index} of $p$ as the dimension of the maximal subspace $V \subset \straightT_pM$ such that $\left. \straightH_p[f] \right|_V$ is negative definite.
	\item {\bf Nullity} of $p$ as the dimension of the null-space of $\straightH_p[f]$, this means, the maximal subspace $N \subset \straightT_pM$ such that $\straightH_p[f](N,\cdot) = 0$.
	\item {\bf Non-degenerate critical points} of $f$ as the points $p$ that have nullity $0$, this means, that the local representation of $\straightH_p[f]$ has maximal rank in any local chart.
\end{itemize}
\end{deff}

Notice that all the definitions that we just gave are independent of the choice of coordinates, because the index and nullity of a matrix are independent of the basis chosen to represent it, so they are also invariant under any change of coordinates.

Therefore, it makes sense to classify the critical points of a manifold according to their index. This is the principle from which the Morse theory is derived.

\begin{deff}
	We say that a function $f \in \mathcal{C}^{\infty}(M)$ is a {\bf Morse function} if all its critical points are non-degenerate.
	If $f$ is a Morse function, we denote
	\[\crit(f) = \{ p \in M \ | d f_p = 0 \} ,\]
	\[\crit_k(f) = \{p \in \crit(f) \ | \text{ $p$ has index $k$}\} .\]
\end{deff}

The first interesting thing to study about the Morse functions is their behaviour in a neighbourhood of a critical point:

\begin{prop} \label{morselemma}
	{\bf (Morse Lemma):} Let $p \in \crit_k(f)$. Then there is a local coordinate system $(U,(y_1,...,y_n))$ centered on $p$ (this means, with $y_i(p) = 0 \ \forall i$) such that
	\[\left. f \right|_U = f(p) - y_1^2 - ... - y_k^2 + y_{k+1}^2 + ... + y_n^2 .\]
\end{prop}

\begin{proof} We begin by looking at a local expression $\tilde{f}$ of $f$ which can be derived from the fundamental theorem of calculus,
\[\tilde{f}(x) = \tilde{f}(0) + \int_0^1 \frac{df(tx_1,...,tx_n)}{dt} dt = f(p) + \int_0^1 \sum_{i=1}^n x_i \der{\tilde{f}}{x_i}(tx_1,...,tx_n) dt .\]

If we take $g_i(x) = \displaystyle\int_0^1 \der{\tilde{f}}{x_i}(tx_1,...,tx_n) dt$, we can write $\tilde{f}$ as
\[\tilde{f}(x) = f(p) + \sum_{i=1}^n x_i g_i(x) .\]
As $g_i(0) = \der{\tilde{f}}{x_i}(0) = 0$, we can apply the same process for each $i$, so there are functions $h_{ij}$ such that
\[g_i(x) = \sum_{j=1}^n x_j h_{ij}(x) ,\]
\[\tilde{f}(x) = f(p) + \sum_{i,j=0}^n x_i x_j h_{ij}(x) .\]
These functions satisfy that
\[h_{ij}(0) = \frac12 \frac{\partial^2 \tilde{f}}{\partial x_i \partial x_j}(0) ,\]
and
\[h_{ij} = h_{ji} .\]
Then, we can apply inductivelly a change of coordinates, maybe shrinking the domain of the chart at each transformation. We describe the idea for each step:

Suppose that we are in the following situation: there is a local coordinate system $(U_1, (u_1,...,u_n))$ (with $U_1 \subseteq U$) such that
\[f = f(p) \pm u_1^2 \pm ... \pm u_{r-1}^2 + \sum_{i,j \geq r} u_i u_i H_{ij}(u) ,\]
where $(H_{ij})_{i,j}$ form a symmetric matrix and $(H_{ij}(0))_{i,j}$ form a non-degenerate matrix. Let us suppose that $H_{rr}(0) \neq 0$ (if it is not the case, we can apply a linear change of coordinates to ensure it). Take $S(u) = \sqrt{|H_{rr}(u)|}$, which will be a non-vanishing positive function of $u$ in a neighbourhood $U_2 \subset U_1$ of $0$. Thus, we can introduce the new local coordinates $(v_1,...,v_n)$ on $U_2$ as
\[v_i = u_i \ \text{ for } i \neq r,\]
\[v_r(u) = S(u) \left[ u_r + \sum_{i > r} u_i \frac{H_{ir}(u)}{H_{rr}(u)} \right] .\]

Using the inverse function theorem we conclude that $(v_1,...,v_r)$ form an invertible and smooth set of coordinates on a neighbourhood of the origin, $U_3 \subset U_2$. Also, it can be seen that
\[f(v) = f(p) + \sum_{i \leq r} \left(\pm v_i^2\right) + \sum_{i,j > r} v_i v_j G_{ij}(v) ,\]
where $G_{ij}$ are symmetric and form a non-degenerate matrix at $v = 0$.

Therefore, after we apply these steps $n$ times we can construct the coordinate system in some neighbourhood $U$ of $p$ satisfying the claimed properties.
\end{proof}

\begin{coro} \label{morselemma_coro}
The non-degenerate critical points of  a differentiable function are isolated.
\end{coro}

\begin{rmrk}
This last corollary is, of course, false for degenerate critical points. Think, for instance, of the function of $\R^2$ defined by $f(x,y) = x^2+y^2+2xy$ in the canonical coordinates. This function has a line of critical points, the one defined by $x + y = 0$, which has no isolated points.
\end{rmrk}

After studying some nice properties about Morse functions, the natural question that arises is if they do actually exist, as the regularity that we are imposing in the definition may be too restrictive. Even if they exist, the Morse functions could be rare in a manifold (for instance, it might be the case that almost all smooth functions have only degenerate critical points). However, in the appendix we provide a positive solution to both questions. In particular:
\begin{itemize}
	\item We can construct a Morse function in any smooth manifold $M$. This is proved in \ref{existenceMorse}.
	\item Any smooth function in $M$ can be approximated, in the $\mathcal{C}^{\infty}$ sense, by Morse functions, so Morse functions are actually generic (this means, dense) in $\mathcal{C}^{\infty}(M)$. This is proved in \ref{proposition:morse_generic}.
\end{itemize}
